# DBTルール ドキュメント

このドキュメントは、`.windsurf/rules/dbt.md`で定義されたDBTルールについて説明します。

## 概要

DBT（Data Build Tool）は、データ変換とデータ品質管理のためのツールです。このプロジェクトでは、dbt v1.9のテストベストプラクティスが定義されており、データ品質を担保するための3つのテスト手法が含まれています。

## 含まれるルール

### 1. Data Tests（データテスト）

**目的**: モデルやテーブルのビジネスルールやデータ一貫性をSQLで検証

**特徴**:
- `tests/`ディレクトリ配下に`.sql`ファイルを作成
- クエリが1行でも結果を返した場合は「テスト失敗」と判定
- 重要なビジネスルールの検証に使用
- 複雑なロジックや集計条件の検証が可能

**実行コマンド**: `dbt test`

### 2. Unit Tests（ユニットテスト）

**目的**: モデルやSQLロジックの単体検証

**特徴**:
- dbt-core v1.8以降で公式サポート
- モデルのYAMLファイルに`unit_tests:`キーで定義
- 入力データ（given）と期待出力（expect）をYAMLで記述
- fixtureはYAML、CSV、SQL形式で記述可能
- CI/Pull Request時に実行推奨

### 3. Schema Tests（スキーマテスト）

**目的**: カラムの制約や一般的なデータ品質ルールの簡潔な検証

**特徴**:
- モデルのYAMLファイルで`tests`キーを使用
- not null、unique制約などの標準テストを定義
- accepted_valuesなどの検証も可能
- 主要カラムすべてに設定を推奨

## ベストプラクティス

### 全般的な運用原則

1. **CI/CDパイプライン統合**: すべてのテストをCI/CDパイプラインに組み込む
2. **失敗時の対応**: テスト失敗時は必ず原因調査と根本原因解決を行う
3. **Pull Request時実行**: Pull Request時に必ずテストを実行する
4. **明確な命名**: テストケースやテスト名は目的が一目で分かるように記述

### テスト種別の使い分け

- **Data Tests**: ビジネスロジックや複雑な条件の検証
- **Unit Tests**: マクロやモデルの単体ロジック検証
- **Schema Tests**: 標準的なデータ品質ルールの自動検証

## ファイル構成

```
.windsurf/rules/dbt.md  # DBTルールの詳細定義
docs/dbt-rules.md       # 本ドキュメント（日本語説明）
```

## 参考

詳細な実装例や具体的なコードサンプルについては、`.windsurf/rules/dbt.md`を参照してください。

---

*このドキュメントは `.windsurf/rules/dbt.md` の内容に基づいて自動生成されました。*